"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(root,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=factory():"function"==typeof define&&define.amd?define("whatInput",[],factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?exports.whatInput=factory():root.whatInput=factory()}(void 0,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports){module.exports=function(){if("undefined"==typeof document||"undefined"==typeof window)return{ask:function(){return"initial"},element:function(){return null},ignoreKeys:function(){},specificKeys:function(){},registerOnChange:function(){},unRegisterOnChange:function(){}};var docElem=document.documentElement,currentElement=null,currentInput="initial",currentIntent=currentInput;try{window.sessionStorage.getItem("what-input")&&(currentInput=window.sessionStorage.getItem("what-input")),window.sessionStorage.getItem("what-intent")&&(currentIntent=window.sessionStorage.getItem("what-intent"))}catch(e){}var eventTimer=null,formInputs=["input","select","textarea"],functionList=[],ignoreMap=[16,17,18,91,93],specificMap=[],inputMap={keydown:"keyboard",keyup:"keyboard",mousedown:"mouse",mousemove:"mouse",MSPointerDown:"pointer",MSPointerMove:"pointer",pointerdown:"pointer",pointermove:"pointer",touchstart:"touch",touchend:"touch"},isBuffering=!1,isScrolling=!1,mousePos={x:null,y:null},pointerMap={2:"touch",3:"touch",4:"mouse"},supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("test",null,opts)}catch(e){}var addListeners=function(){var options=!!supportsPassive&&{passive:!0};window.PointerEvent?(window.addEventListener("pointerdown",setInput),window.addEventListener("pointermove",setIntent)):window.MSPointerEvent?(window.addEventListener("MSPointerDown",setInput),window.addEventListener("MSPointerMove",setIntent)):(window.addEventListener("mousedown",setInput),window.addEventListener("mousemove",setIntent),"ontouchstart"in window&&(window.addEventListener("touchstart",eventBuffer,options),window.addEventListener("touchend",setInput))),window.addEventListener(detectWheel(),setIntent,options),window.addEventListener("keydown",eventBuffer),window.addEventListener("keyup",eventBuffer),window.addEventListener("focusin",setElement),window.addEventListener("focusout",clearElement)},setInput=function(event){if(!isBuffering){var eventKey=event.which,value=inputMap[event.type];"pointer"===value&&(value=pointerType(event));var ignoreMatch=!specificMap.length&&-1===ignoreMap.indexOf(eventKey),specificMatch=specificMap.length&&-1!==specificMap.indexOf(eventKey),shouldUpdate="keyboard"===value&&eventKey&&(ignoreMatch||specificMatch)||"mouse"===value||"touch"===value;if(currentInput!==value&&shouldUpdate){currentInput=value;try{window.sessionStorage.setItem("what-input",currentInput)}catch(e){}doUpdate("input")}if(currentIntent!==value&&shouldUpdate){var activeElem=document.activeElement;if(activeElem&&activeElem.nodeName&&-1===formInputs.indexOf(activeElem.nodeName.toLowerCase())){currentIntent=value;try{window.sessionStorage.setItem("what-intent",currentIntent)}catch(e){}doUpdate("intent")}}}},doUpdate=function(which){docElem.setAttribute("data-what"+which,"input"===which?currentInput:currentIntent),fireFunctions(which)},setIntent=function(event){if(detectScrolling(event),!isBuffering&&!isScrolling){var value=inputMap[event.type];if("pointer"===value&&(value=pointerType(event)),currentIntent!==value){currentIntent=value;try{window.sessionStorage.setItem("what-intent",currentIntent)}catch(e){}doUpdate("intent")}}},setElement=function(event){event.target.nodeName?(currentElement=event.target.nodeName.toLowerCase(),docElem.setAttribute("data-whatelement",currentElement),event.target.classList&&event.target.classList.length&&docElem.setAttribute("data-whatclasses",event.target.classList.toString().replace(" ",","))):clearElement()},clearElement=function(){currentElement=null,docElem.removeAttribute("data-whatelement"),docElem.removeAttribute("data-whatclasses")},eventBuffer=function(event){setInput(event),window.clearTimeout(eventTimer),isBuffering=!0,eventTimer=window.setTimeout(function(){isBuffering=!1},120)},pointerType=function(event){return"number"==typeof event.pointerType?pointerMap[event.pointerType]:"pen"===event.pointerType?"touch":event.pointerType},detectWheel=function(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"},fireFunctions=function(type){for(var i=0,len=functionList.length;i<len;i++)functionList[i].type===type&&functionList[i].fn.call(void 0,"input"===type?currentInput:currentIntent)},detectScrolling=function(event){mousePos.x!==event.screenX||mousePos.y!==event.screenY?(isScrolling=!1,mousePos.x=event.screenX,mousePos.y=event.screenY):isScrolling=!0};return"addEventListener"in window&&Array.prototype.indexOf&&(inputMap[detectWheel()]="mouse",addListeners(),doUpdate("input"),doUpdate("intent")),{ask:function(opt){return"intent"===opt?currentIntent:currentInput},element:function(){return currentElement},ignoreKeys:function(arr){ignoreMap=arr},specificKeys:function(arr){specificMap=arr},registerOnChange:function(fn,eventType){functionList.push({fn:fn,type:eventType||"input"})},unRegisterOnChange:function(fn){var position=function(match){for(var i=0,len=functionList.length;i<len;i++)if(functionList[i].fn===match)return i}(fn);(position||0===position)&&functionList.splice(position,1)}}}()}])});